<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >

  <!--! List of packages: pass in a collection of tags and this renders the
        standard package listing -->
  <ul py:def="package_list_local(packages)" class="packages">
    <li py:for="package in packages"
        class="${'fullyopen' if ((package.isopen if isinstance(package.isopen,bool) else package.isopen()) and package.resources) else None}">
        <div class="header">
			<span class="title">
				${h.link_to(package.title or package.name, h.url_for(controller='package', action='read', id=package.name))}
			</span>
			
			<div class="search_meta">
        <py:if test="package.resources">
          <ul class="package_formats">
            <py:for each="resource in package.resources">
              <py:if test="resource.format and not resource.format == ''">
                <li>${resource.format}</li>
              </py:if>
            </py:for>
          </ul>
        </py:if>
        <ul class="openness">
          <py:if test="package.isopen if isinstance(package.isopen,bool) else package.isopen()">
            <li>
              <a href="http://opendefinition.org/okd/" title="This package satisfies the Open Definition.">
                  <img src="http://assets.okfn.org/images/ok_buttons/od_80x15_blue.png" alt="[Open Data]" />
              </a>
            </li>
            <li>
              <a href="http://opendefinition.org/okd/" title="This package satisfies the Open Definition.">
                  <img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" alt="[Open Content]" />
              </a>
            </li>
          </py:if>
          <py:if test="not (package.isopen if isinstance(package.isopen,bool) else package.isopen())">
            <li>
              <span class="closed">
                ${h.icon('lock')} Not Openly Licensed
              </span>
            </li>
          </py:if>
        </ul>
      </div>
    </div>
	<div class="package-result-links">
        ${h.link_to('View Metadata', h.url_for(controller='package', action='read', id=package.name))}
        <py:if test="package.resources">
             | ${h.link_to('Download file', package.resources[0].url,target='_blank')}
            <py:if test="config.get('iati.preview_service','')">
                 | ${h.link_to('Preview file',  config.get('iati.preview_service') % package.resources[0].url, target='_blank')}
            </py:if>
            <py:if test="config.get('iati.csv_service','')">
                <?python
                    file_type = [e['value'] for e in package['extras'] if e['key'] == 'filetype']
                    file_type = h.json.loads(file_type[0]) if file_type else None 
                ?>
                <py:if test="file_type and file_type != 'organisation'">
                 | ${h.link_to('Download as CSV',  config.get('iati.csv_service') % package.resources[0].url, target='_blank')}
                </py:if>
            </py:if>
        </py:if>
    </div>
    </li>
  </ul>

  <!--! List of tags: pass in a collection of tags and this renders the standard
        tag listing -->
  <ul py:def="tag_list_local(tags)" class="" style="margin-bottom:30px" >
    <li py:for="tag in tags" style="float:left">
      ${h.link_to(tag['name'], h.url_for(controller='tag', action='read', id=tag['name']))}
    </li>
  </ul>


</html>



