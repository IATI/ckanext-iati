<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >
  <py:def function="optional_head()">
  <script src="/scripts/jquery.linkify-1.0-min.js"></script>
  <script src="/scripts/tablesorter.js"></script>
  <script src="/scripts/app.js"></script>
  <script>
    $(document).ready(function(){
      $('#publisher-info').linkify();
      $('.view-full').click(CKAN.IATI.openGroupDetails);
    });
  </script>
  </py:def>
  <py:match path="primarysidebar">
    <div id="publisher-dialog" class="ckan-dialog"/>
    <div py:if=" not (c.action == 'new' or c.action == 'edit')" class="box">
      <h2>Publishers section</h2>
      <p>
	<span class="ckan_logged_out" style="display: none;">
	  To create a new publisher, please first <a href="${h.url_for(controller='user',action='login', id=None)}">login</a>.
	</span>
	<span class="ckan_logged_in">
	  <a href="/publisher/new">Create a new publisher</a>
	</span>
      </p>
      
    </div>

    <div py:if="c.group and c.group.state == 'active' and c.action != 'authz'" class="box feed-box" id="publisher-feeds">
        <h2>Follow publisher</h2>
        <div>
            <a href="/feed/publisher/${c.group.name}.atom">Subscribe</a>
        </div>
    </div>

    <div py:if="c.action == 'index'" class="box">
        Hint: Click on the table headers to sort the rows ascending or descending.
    </div>

    <div py:if="c.group and c.action != 'authz'" class="box" id="publisher-info">

      <h2>About this publisher</h2>

      <a name="view-full" class="view-full" href="#">View in a larger window [+]</a>
      <p>
	<dl py:for="(field_id, field_title, description) in h.publisher_record_fields">
	  <dt>${field_title}</dt>
	  <dd>${c.group.extras.get(field_id, 'n/a').strip() or 'n/a'}</dd>
	</dl>
      </p>
      
    </div>
  </py:match>
  
  <py:match path="minornavigation" py:if="c.group">
  <ul>
    <li>${h.subnav_link(c, h.icon('group') + _('View'), controller='group', action='read', id=c.group.name)}</li>
    <li py:if="h.am_authorized(c, actions.EDIT, c.group)">
      ${h.subnav_link(c, h.icon('group_edit') + _('Edit'), controller='group', action='edit', id=c.group.name)}
    </li>
    <li>${h.subnav_link(c, h.icon('page_white_stack') + _('History'), controller='group', action='history', id=c.group.name)}</li>
    <li py:if="h.am_authorized(c, actions.EDIT_PERMISSIONS, c.group)">
      ${h.subnav_link(c, h.icon('lock') + _('Authorization'), controller='group', action='authz', id=c.group.name)}
    </li>
  </ul>
  </py:match>
  
  <xi:include href="../layout.html" />
</html>
