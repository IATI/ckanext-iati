{% extends "page.html" %}

{% block primary %}
              <div class="primary col-sm-9 col-xs-12">
                {#
                The primary_content block can be used to add content to the page.
                This is the main block that is likely to be used within a template.

                Example:

                  {% block primary_content %}
                    <h1>My page content</h1>
                    <p>Some content for the page</p>
                  {% endblock %}
                #}
                {% block primary_content %}
                  <article class="module">
                    {% block page_header %}
                      <header class="module-content page-header">
                        {% if self.content_action() | trim %}
                          <div class="content_action">
                            {% block content_action %}{% endblock %}
                          </div>
                        {% endif %}
                        <ul class="nav nav-tabs">

{% block content_primary_nav %}

  {{ h.build_nav_icon('publisher_read', _('Datasets'), id=id) }}
  {{ h.build_nav_icon('publisher_activity', _('Activity Stream'), id=id) }}
  {{ h.build_nav_icon('publisher_about', _('About'), id=id) }}
  {{ h.build_nav_icon('publisher_archiver', _('Archiver'), id=id) }}

{% endblock %}
                        </ul>
                      </header>
                    {% endblock %}

                    <div class="module-content">
                       <table class="table table-hover table-bordered table-striped table-sorted table-condensed w-auto table-fit" data-module="table-sorter" id="issues_report_table">
  <thead>
    <tr>
        <th title="Index No">No</th>
      <th title="Sort by publisher name">Dataset Name</th>
      <th title="Dataset Name">Status</th>
      <th title="Message">Message</th>
    </tr>
  </thead>

  <tbody>

  </tbody>
</table>
                    </div>
                  </article>
                {% endblock %}
              </div>
<script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
<script>

var PollState = function(task_id) {
          $.ajax({
              url: "/publisher/archiver/status/" + task_id,
              type: "GET",
          }).done(function(task) {
              task = JSON.parse(task);
              console.log(task);
             if (task.status !== "finished" && task.status !== "failed") {
                  if (task.status =="started"){
                    setTimeout(PollState(task_id), 3000)
                  }else{
                    setTimeout(PollState(task_id), 10000)
                  }
              }else{

                //console.log(task);
              }
          }).fail(function(task){


              //colnsole.log(task)
          });
      }

function statusbutton(string) {

          var buttonClass="";
          switch (string){
             case "error(s)":
             case "failed" :
                    buttonClass ="label label-danger"
                    break ;
             case "finished" :
                    buttonClass ="label label-success"
                    break ;
             case "started" :
                    buttonClass ="label label-info"
                    break ;
             default:
                    buttonClass ="label label-warning"
                    break;
          }
          return '<span class="' + buttonClass +   '" data-placement="right" title="'+string+'">'+capitalizeFirstLetter(string)+'</span>'


      }

var tasks = {{tasks | safe }};
for (i=0; i < tasks.length; i++){
var task = JSON.parse(tasks[i])
var cnt = (i+1).toString();
$('#issues_report_table').find('tbody').append('<tr><td>'+cnt+'</td><td>'+task.title+'</td><td><span class="label label-info" data-placement="right" title="queued" id='+task.task_id+'>'+task.status+'</span></td><td></td></tr>');
PollState(task.task_id)}
</script>
{% endblock %}
