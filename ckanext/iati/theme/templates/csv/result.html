{% extends "page.html" %}
{% block title %}CSV Import Results - {{ super() }}{% endblock %}

{% block primary_content %}
<h2 class="page_heading">CSV Export</h2>
  <article>
  <div>CSV file <strong>{{file_name}}</strong> imported. (<a href="/csv/upload">Upload another file</a>)</div> {{ result }}
    <hr class="cleared" />

    <div class="lds-css ng-scope" id="wait">
      <div style="width:100%;height:100%" class="lds-bars">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>

    <div id="result"></div>

    <div id="summary" class="hidden">
   <h3>Summary</h3>
   <ul>
      <li><a href="#added">Datasets created: <span id="added-count">{{ added|length }}</span></a></li>
      <li><a href="#updated">Datasets updated: <span id="updated-count">{{ updated|length }}</span></a></li>
      <li><a href="#warnings">Warnings found: <span id="warnings-count">{{ warnings|length }}</span></a></li>
      <li><a href="#errors">Errors found: <span id="errors-count">{{ errors|length }}</span></a></li>
    </ul>
    <h3 id="added">Datasets added</h3>
    <ul id="added-inner">
        <li><i>None</i></li>
    </ul>

    <h3 id="updated">Datasets updated</h3>
    <ul id="updated-inner">
        <li><i>None</i></li>
    </ul>

    <h3 id="warnings">Warnings</h3>
    <ul id="warnings-inner">
      {% for row,fields in warnings %}
    <li>Line {{row}}:
            <ul>
              {% for field, msgs in fields.iteritems() %}
            <li><strong>{{field}}</strong>: {{msgs}}</li>
            {% endfor %}
            </ul>
        </li>
        {% endfor %}
        {% if not warnings %}
        <li><i>None</i></li>
        {% endif %}

    </ul>

    <h3 id="errors">Errors found</h3>
    <ul id="errors-inner">
      {% for row,fields in errors%}
    <li>Line {{row}}:
            <ul>
              {% for field,msgs in fields.iteritems() %}
            <li><strong>{{field}}</strong>: {{msgs}}</li>
            {% endfor %}
            </ul>
        </li>
        {% endfor %}
        {% if not errors %}
        <li><i>None</i></li>
        {% endif %}

    </ul>
</div>
  </article>
  {% endblock %}

  {% block scripts %}
      {{ super() }}
      <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>

    {% resource 'ckanext-iati/query_status' %}
  {% endblock%}
